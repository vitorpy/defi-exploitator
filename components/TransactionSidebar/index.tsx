import * as React from "react";
import { Button } from "semantic-ui-react";
import { useWallet } from 'use-wallet';
import { IChart } from "@mrblenny/react-flow-chart";
import { ethers } from 'ethers';

import { Message } from "../Common";
import { EXECUTOR_ADDRESS, EXECUTOR_ABI } from "../../constants";
import { HELLOWORLD_ADDRESS, HELLOWORLD_ABI } from "../../constants";

export interface ITransactionSidebarProps {
  chart: IChart
}

export function TransactionSidebar({ chart } : ITransactionSidebarProps) {
  const wallet = useWallet()

  const message = "Details about your transaction will appear here.";

  const generateTransaction = () => {
    const provider = new ethers.providers.Web3Provider(wallet.ethereum);
    const signer = provider.getSigner();

    const helloworldContract = new ethers.utils.Interface(HELLOWORLD_ABI);
    const txData = helloworldContract.functions.say.encode(["World!"]);

    const executorContract = new ethers.Contract(EXECUTOR_ADDRESS, EXECUTOR_ABI, signer);
    const sendPromise = executorContract.execute(HELLOWORLD_ADDRESS, 0, txData, 0, 20000);

    sendPromise.then((tx : any) => {
      console.log(tx);
    });
  }

  return (
    <>
      <Message>
        {message}
      </Message>

      {!wallet.connected ? (
        <Button onClick={() => wallet.activate()}>Connect with MetaMask</Button>
      ) : (
        <Button onClick={generateTransaction}>Send Transaction</Button>
      )}
    </>
  )
}
