import * as React from "react";
import { Button } from "semantic-ui-react";
import { useWallet } from 'use-wallet';
import { IChart } from "@mrblenny/react-flow-chart";
import { ethers } from 'ethers';

import { Message } from "../Common";
import { HELLOWORLD_ADDRESS, HELLOWORLD_ABI } from "../../constants";

export interface ITransactionSidebarProps {
  chart: IChart
}

export function TransactionSidebar({ chart } : ITransactionSidebarProps) {
  const wallet = useWallet()

  const message = "Details about your transaction will appear here.";

  const generateTransaction = () => {
    const tx = {
      to: wallet.account,
      value: 0,
    };

    const provider = new ethers.providers.Web3Provider(wallet.ethereum);
    const signer = provider.getSigner();

    const contract = new ethers.Contract(HELLOWORLD_ADDRESS, HELLOWORLD_ABI, signer);
    //const sendPromise = signer.sendTransaction(tx);
    const sendPromise = contract.say("World!");

    sendPromise.then((tx : any) => {
      console.log(tx);
    });
  }

  return (
    <>
      <Message>
        {message}
      </Message>

      {!wallet.connected ? (
        <Button onClick={() => wallet.activate()}>Connect with MetaMask</Button>
      ) : (
        <Button onClick={generateTransaction}>Send Transaction</Button>
      )}
    </>
  )
}
